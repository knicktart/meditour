import 'package:flutter/material.dart';import 'package:flutter_tts/flutter_tts.dart';import '../../services/chat_service.dart';
class ChatPage extends StatefulWidget{const ChatPage({super.key});@override State<ChatPage> createState()=>_S();}
class _S extends State<ChatPage>{final _t=TextEditingController();final _msgs=<Map<String,String>>[];late final FlutterTts _tts;late final ChatService _chat;bool _busy=false;
 @override void initState(){super.initState();_tts=FlutterTts();_chat=ChatService();_chat.init();}
 Future<void> _send() async{final m=_t.text.trim();if(m.isEmpty)return;setState(()=>_busy=true);_msgs.add({'role':'user','text':m});_t.clear();final r=await _chat.respond(m);setState(()=>_msgs.add({'role':'bot','text':r}));await _tts.speak(r);if(mounted)setState(()=>_busy=false);}
 @override Widget build(BuildContext c){return Scaffold(appBar:AppBar(title:const Text('AI Voice Chatbot')),drawer:const Drawer(child:SafeArea(child:Padding(padding:EdgeInsets.all(12),child:Text('Chat is restricted to Turkey Medical Tourism.')))),body:Column(children:[Expanded(child:ListView.builder(padding:const EdgeInsets.all(12),itemCount:_msgs.length,itemBuilder:(cx,i){final m=_msgs[i];final mine=m['role']=='user';return Align(alignment:mine?Alignment.centerRight:Alignment.centerLeft,child:Container(margin:const EdgeInsets.symmetric(vertical:4),padding:const EdgeInsets.all(10),decoration:BoxDecoration(color:mine?Colors.teal.shade100:Colors.grey.shade200,borderRadius:BorderRadius.circular(12)),child:Text(m['text']??'')));})),Padding(padding:const EdgeInsets.all(12),child:Row(children:[Expanded(child:TextField(controller:_t,decoration:const InputDecoration(hintText:'Ask about Turkey Medical Tourism...'))),const SizedBox(width:8),FilledButton(onPressed:_busy?null:_send,child:Text(_busy?'...':'Send'))]))]));}
}
